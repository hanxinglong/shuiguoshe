$("#<%= @item_id %>").data("loading", '0');

<% if @success %>

// 计算购物车总数
var total = $("#cart_2_total_items").data("cart-total");
total = parseInt(total) + 1;
$("#cart_2_total_items").data("cart-total", total);
$("#cart_2_total_items").text(total);

$("#cart_2_total_items_2").text(total);

$("#cart_2_panel_body").html("<%= j render 'carts/cart_2' %>");
$("#cart_2_total_price").text("<%= product_price_tag(cart.total_price) %>");

// 添加到购物车动画
var cart = $("#u-cart-result");
var imgtodrag = $("#<%= @product_id %>").find("img").eq(0);
if (imgtodrag) {
  var imgclone = imgtodrag.clone().offset({
    top: imgtodrag.offset().top,
    left: imgtodrag.offset().left
  })
  .css({
    'opacity': '0.5',
    'position': 'absolute',
    'height': '150px',
    'width': '150px',
    'z-index': '10000'
  })
  .appendTo($('body'))
  .animate({
    'top': cart.offset().top + 10,
    'left': cart.offset().left + 10,
    'width': 75,
    'height': 75,
  }, 1000);
  
  imgclone.animate({
    'width': 0,
    'height': 0
  }, function() {
    $(this).detach();
  });
}

<% else %>

<% end %>